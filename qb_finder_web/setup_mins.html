<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="https://monkieeboi.github.io/pc/favicon.ico" />

    <title>Minimals</title>

    <style type="text/css">
      * {
        font-family: monospace;
      }

      body {
        color: #fff;
        background-color: #2e3440;
      }

      #header {
        margin: 10px;
        padding: 20px;
        width: 200px;
      }

      #header progress {
        width: 100%;
      }

      #header h1 {
        margin: 0;
        margin-bottom: 20px;
      }

      .loading {
        width: 200px;
        border-radius: 4px;
        height: 104px;
        margin: 10px;
        padding: 0;
        left: -150%;
        background: linear-gradient( 67deg, #3b4252 25%, #434c5e 50%, #4c566a 75% );
        background-size: 200% 100%;
        animation: shim 1.5s infinite linear;
      }
      @keyframes shim { from { background-position: 200% 0; } to { background-position: -200% 0; } }

      mino-board {
        display: block;

        width: 200px;
        white-space: pre-line;
        padding: 10px;
      }

      mino-board > svg {
        border-radius: 4px;
      }

      section {
        margin: 0;
        padding: 10px 20px;
      }

      h2 {
        font-size: large;
      }

      mino-board rect[fill="#F3F3ED"] {
        fill: #3b4252;
      }

      mino-board rect[fill="#E7E7E2"] {
        fill: #3b4252;
      }

      div {
        display: grid;
        grid: auto-flow / repeat(auto-fill, 200px);
        gap: 10px;
        justify-content: space-evenly;
        place-items: center;

        padding: 10px;
      }
    </style>
  </head>

  <body>
    <header id="header">
      <h1>Minimals</h1>
      <div class="loading"></div>
    </header>

    <section>
      <h2>Common</h2>
      <div id="common">
        <div class="loading"></div>
        <div class="loading"></div>
        <div class="loading"></div>
      </div>
    </section>

    <section id="unique"></section>

    <script src="mino-board.js"></script>
    <script src="pkg/qb_finder_web.js"></script>
    <script type="module">
      let worker = new Worker("worker.js");
      let header = document.getElementById("header");
      let common = document.getElementById("common");
      let unique = document.getElementById("unique");
      const params = new URLSearchParams(window.location.search);

      worker.onmessage = message => {
        if (message.data.kind == "ready") {
          worker.postMessage({
            setup: params.get("setup"),
            build_queue: params.get("build_queue"),
            solve_queue: params.get("solve_queue"),
            save: params.get("save")
          });
          return;
        }
        let [board, commons, ...uniques] = message.data.res.split("|");

        document.querySelectorAll(".loading").forEach((el) => el.remove());

        header.appendChild(new MinoBoard(board));

        for (const solve of commons.split(",")) {
          common.appendChild(new MinoBoard(solve));
        }

        for (const [i, solves] of uniques.entries()) {
          if (solves == "") {
            continue;
          }
          let container = document.createElement("div");
          let label = document.createElement("h2");
          label.textContent = `Set ${i + 1}`;
          unique.appendChild(label);
          for (const solve of solves.split(",")) {
            container.appendChild(new MinoBoard(solve));
          }
          unique.appendChild(container);
        }
      }
    </script>
  </body>
</html>
